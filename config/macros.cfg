[gcode_macro CENTER_HEAD]
gcode:
  SAVE_GCODE_STATE
  G90
  G0 X150 Y150 F12000
  RESTORE_GCODE_STATE

[gcode_macro MOVE_HEAD_OUT_OF_WAY]
gcode:
  SAVE_GCODE_STATE
  G90
  G0 X150 Y305 F12000
  RESTORE_GCODE_STATE

[gcode_macro NOZZLE_WIPE]
gcode:
  SAVE_GCODE_STATE
  G90
  G1 X195 Y300 Z20 F10000
  M109 S200   ; heat nozzle
  G4 P2000    ; wait
  G1 Y305 Z10 F4000
  G1 E5
  G1 X245 F14000
  G1 X195 F14000
  G1 X245 F14000
  G1 X195 F14000
  G1 E-5
  M109 S0
  G1 X245 F14000
  G1 X195 F14000
  G1 Z20 
  _READY_DISPLAY
  RESTORE_GCODE_STATE

[gcode_macro PRINT_START]
# PRINT_START for the slicer starting script
gcode:
  G28                            ; home all axes
  Z_TILT_ADJUST
  BED_MESH_CALIBRATE
  _PRINTING_DISPLAY
  CENTER_HEAD

[gcode_macro PRINT_END]
# PRINT_END for the slicer ending script
gcode:
  M400                           ; wait for buffer to clear
  G92 E0                         ; zero the extruder
  G1 E-10.0 F3600                ; retract filament
  G91                            ; relative positioning
  G0 Z1.00 X20.0 Y20.0 F20000    ; move nozzle to remove stringing
  TURN_OFF_HEATERS
  M107                           ; turn off fan
  G1 Z2 F3000                    ; move nozzle up 2mm
  G90                            ; absolute positioning
  G0  X150 Y305 F3600            ; park nozzle at rear
  BED_MESH_CLEAR
  _READY_DISPLAY

# Conditional G28 (home if not already homed)
[gcode_macro CG28]
gcode:
    {% if "x" not in printer.toolhead.homed_axes or "y" not in printer.toolhead.homed_axes or "z" not in printer.toolhead.homed_axes %}
    G28
    {% endif %}