[gcode_macro CENTER_HEAD]
gcode:
  SAVE_GCODE_STATE
  G90
  G0 X150 Y150 Z30 F12000
  RESTORE_GCODE_STATE

[gcode_macro NOZZLE_WIPE]
gcode:
  SAVE_GCODE_STATE
  G90
  NOZZLE_WIPE_DISPLAY
  G1 X195 Y300 Z20 F10000
  M109 S200   ; heat nozzle
  G4 P2000    ; wait
  G1 Y305 Z10 F4000
  G1 E5
  G1 X245 F14000
  G1 X195 F14000
  G1 X245 F14000
  G1 X195 F14000
  G1 E-5
  M109 S0
  G1 X245 F14000
  G1 X195 F14000
  G1 Z20 
  READY_DISPLAY
  RESTORE_GCODE_STATE

[gcode_macro PRINT_START]
# PRINT_START for the slicer starting script
gcode:
  G28                            ; home all axes
  Z_TILT_ADJUST
  BED_MESH_CALIBRATE
  PRINTING_DISPLAY
  CENTER_HEAD

[gcode_macro PRINT_END]
# PRINT_END for the slicer ending script
gcode:
  M400                           ; wait for buffer to clear
  G92 E0                         ; zero the extruder
  G1 E-10.0 F3600                ; retract filament
  G91                            ; relative positioning
  G0 Z1.00 X20.0 Y20.0 F20000    ; move nozzle to remove stringing
  TURN_OFF_HEATERS
  M107                           ; turn off fan
  G1 Z2 F3000                    ; move nozzle up 2mm
  G90                            ; absolute positioning
  G0  X150 Y305 F3600            ; park nozzle at rear
  BED_MESH_CLEAR
  READY_DISPLAY

[gcode_macro NOZZLE_WIPE_DISPLAY]
gcode:
  STOP_LED_EFFECTS
  M117 Wipping nozzle...
  SET_LED LED=btt_mini12864 RED=1 GREEN=1 BLUE=0 INDEX=1 TRANSMIT=0
  SET_LED LED=btt_mini12864 RED=1 GREEN=1 BLUE=0 INDEX=2 TRANSMIT=0
  SET_LED LED=btt_mini12864 RED=0 GREEN=0.705882353 BLUE=0.737254902 INDEX=3
  SET_LED LED=bedfront RED=1 GREEN=1 BLUE=0 WHITE=0
  
[gcode_macro PROBING_DISPLAY]
gcode:
  STOP_LED_EFFECTS
  M117 Probing...
  SET_LED LED=bedfront RED=0 GREEN=0 BLUE=1
  SET_LED LED=btt_mini12864 RED=0 GREEN=0 BLUE=1 INDEX=1 TRANSMIT=0
  SET_LED LED=btt_mini12864 RED=0 GREEN=0 BLUE=1 INDEX=2 TRANSMIT=0
  SET_LED LED=btt_mini12864 RED=0 GREEN=0.705882353 BLUE=0.737254902 INDEX=3
  
[gcode_macro PRINTING_DISPLAY]
gcode:
  M117 Printing...
  SET_LED_EFFECT EFFECT=ready STOP=1
  SET_LED_EFFECT EFFECT=printing
  SET_LED LED=btt_mini12864 RED=0 GREEN=0.705882353 BLUE=0.737254902 INDEX=1 TRANSMIT=0
  SET_LED LED=btt_mini12864 RED=0 GREEN=0.705882353 BLUE=0.737254902 INDEX=2 TRANSMIT=0
  SET_LED LED=btt_mini12864 RED=0 GREEN=0.705882353 BLUE=0.737254902 INDEX=3

[gcode_macro READY_DISPLAY]
gcode:
  M117 Ready
  SET_LED_EFFECT EFFECT=printing STOP=1
  SET_LED_EFFECT EFFECT=ready
  SET_LED LED=btt_mini12864 RED=0.8 GREEN=0 BLUE=1 INDEX=1 TRANSMIT=0
  SET_LED LED=btt_mini12864 RED=0.8 GREEN=0 BLUE=1 INDEX=2 TRANSMIT=0
  SET_LED LED=btt_mini12864 RED=0 GREEN=0.705882353 BLUE=0.737254902 INDEX=3
